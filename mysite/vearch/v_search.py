#搜索
# 从插入的图片中随机选一张进行搜索
import os
import random
import json
import requests
#ip = "http://172.16.17.31:4101"
#headers = {"content-type": "application/json"}
#linux路径
#path = "/itcast/Corel5k/1000"
#windows路径
#path = "L:/ImageSet/Corel5k/1000"
#file = random.choice(os.listdir(path))
#print(file)
#file_path = os.path.join(path, file)
#resp = requests.post(ip+"/test/test1/_search", headers=headers, data=json.dumps({ "query": { "sum": [{"feature": file_path, "field": "feature1"}]},"is_brute_search":1}))
#assert resp.status_code == 200, "search data failed, " + resp.text
dic = {"took":1,"timed_out":'false',"_shards":{"total":1,"successful":1},"hits":{"total":50,"max_score":1.0000001192092896,"hits":[{"_index":"test","_type":"test1","_id":"10097","_score":1.0000001192092896,"_extra":{"vector_result":[{"field":"feature1","source":"","score":1}]},"_source":{"url":"/itcast/Corel5k/10000/10097.jpeg"}},{"_index":"test","_type":"test1","_id":"10022","_score":0.7848025560379028,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.784803}]},"_source":{"url":"/itcast/Corel5k/10000/10022.jpeg"}},{"_index":"test","_type":"test1","_id":"34058","_score":0.7718790769577026,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.771879}]},"_source":{"url":"/itcast/Corel5k/34000/34058.jpeg"}},{"_index":"test","_type":"test1","_id":"34095","_score":0.7717073559761047,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.771707}]},"_source":{"url":"/itcast/Corel5k/34000/34095.jpeg"}},{"_index":"test","_type":"test1","_id":"34093","_score":0.7503600716590881,"_extra":{"vector_result":[{"source":"","score":0.75036,"field":"feature1"}]},"_source":{"url":"/itcast/Corel5k/34000/34093.jpeg"}},{"_index":"test","_type":"test1","_id":"10099","_score":0.7475122213363647,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.747512}]},"_source":{"url":"/itcast/Corel5k/10000/10099.jpeg"}},{"_index":"test","_type":"test1","_id":"10082","_score":0.7418778538703918,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.741878}]},"_source":{"url":"/itcast/Corel5k/10000/10082.jpeg"}},{"_index":"test","_type":"test1","_id":"21098","_score":0.7398902177810669,"_extra":{"vector_result":[{"source":"","score":0.73989,"field":"feature1"}]},"_source":{"url":"/itcast/Corel5k/21000/21098.jpeg"}},{"_index":"test","_type":"test1","_id":"10058","_score":0.7397364974021912,"_extra":{"vector_result":[{"score":0.739736,"field":"feature1","source":""}]},"_source":{"url":"/itcast/Corel5k/10000/10058.jpeg"}},{"_index":"test","_type":"test1","_id":"34086","_score":0.7386863231658936,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.738686}]},"_source":{"url":"/itcast/Corel5k/34000/34086.jpeg"}},{"_index":"test","_type":"test1","_id":"34076","_score":0.73837810754776,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.738378}]},"_source":{"url":"/itcast/Corel5k/34000/34076.jpeg"}},{"_index":"test","_type":"test1","_id":"22035","_score":0.7362701892852783,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.73627}]},"_source":{"url":"/itcast/Corel5k/22000/22035.jpeg"}},{"_index":"test","_type":"test1","_id":"10020","_score":0.7344611287117004,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.734461}]},"_source":{"url":"/itcast/Corel5k/10000/10020.jpeg"}},{"_index":"test","_type":"test1","_id":"10081","_score":0.7343276143074036,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.734328}]},"_source":{"url":"/itcast/Corel5k/10000/10081.jpeg"}},{"_index":"test","_type":"test1","_id":"10095","_score":0.7317867279052734,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.731787}]},"_source":{"url":"/itcast/Corel5k/10000/10095.jpeg"}},{"_index":"test","_type":"test1","_id":"34087","_score":0.7300512194633484,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.730051}]},"_source":{"url":"/itcast/Corel5k/34000/34087.jpeg"}},{"_index":"test","_type":"test1","_id":"34042","_score":0.7268962264060974,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.726896}]},"_source":{"url":"/itcast/Corel5k/34000/34042.jpeg"}},{"_index":"test","_type":"test1","_id":"10018","_score":0.7261612415313721,"_extra":{"vector_result":[{"source":"","score":0.726161,"field":"feature1"}]},"_source":{"url":"/itcast/Corel5k/10000/10018.jpeg"}},{"_index":"test","_type":"test1","_id":"34056","_score":0.7250446081161499,"_extra":{"vector_result":[{"score":0.725045,"field":"feature1","source":""}]},"_source":{"url":"/itcast/Corel5k/34000/34056.jpeg"}},{"_index":"test","_type":"test1","_id":"34011","_score":0.7245866656303406,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.724587}]},"_source":{"url":"/itcast/Corel5k/34000/34011.jpeg"}},{"_index":"test","_type":"test1","_id":"10027","_score":0.7233157753944397,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.723316}]},"_source":{"url":"/itcast/Corel5k/10000/10027.jpeg"}},{"_index":"test","_type":"test1","_id":"10025","_score":0.7208271622657776,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.720827}]},"_source":{"url":"/itcast/Corel5k/10000/10025.jpeg"}},{"_index":"test","_type":"test1","_id":"34040","_score":0.719846785068512,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.719847}]},"_source":{"url":"/itcast/Corel5k/34000/34040.jpeg"}},{"_index":"test","_type":"test1","_id":"10002","_score":0.7172650098800659,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.717265}]},"_source":{"url":"/itcast/Corel5k/10000/10002.jpeg"}},{"_index":"test","_type":"test1","_id":"34017","_score":0.716274082660675,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.716274}]},"_source":{"url":"/itcast/Corel5k/34000/34017.jpeg"}},{"_index":"test","_type":"test1","_id":"34075","_score":0.7132716178894043,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.713272}]},"_source":{"url":"/itcast/Corel5k/34000/34075.jpeg"}},{"_index":"test","_type":"test1","_id":"10059","_score":0.7110676169395447,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.711068}]},"_source":{"url":"/itcast/Corel5k/10000/10059.jpeg"}},{"_index":"test","_type":"test1","_id":"10060","_score":0.7099253535270691,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.709925}]},"_source":{"url":"/itcast/Corel5k/10000/10060.jpeg"}},{"_index":"test","_type":"test1","_id":"10016","_score":0.7075508832931519,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.707551}]},"_source":{"url":"/itcast/Corel5k/10000/10016.jpeg"}},{"_index":"test","_type":"test1","_id":"10010","_score":0.7072089314460754,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.707209}]},"_source":{"url":"/itcast/Corel5k/10000/10010.jpeg"}},{"_index":"test","_type":"test1","_id":"10098","_score":0.7054668068885803,"_extra":{"vector_result":[{"score":0.705467,"field":"feature1","source":""}]},"_source":{"url":"/itcast/Corel5k/10000/10098.jpeg"}},{"_index":"test","_type":"test1","_id":"21017","_score":0.7053688168525696,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.705369}]},"_source":{"url":"/itcast/Corel5k/21000/21017.jpeg"}},{"_index":"test","_type":"test1","_id":"10024","_score":0.7040218710899353,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.704022}]},"_source":{"url":"/itcast/Corel5k/10000/10024.jpeg"}},{"_index":"test","_type":"test1","_id":"10083","_score":0.7038295865058899,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.70383}]},"_source":{"url":"/itcast/Corel5k/10000/10083.jpeg"}},{"_index":"test","_type":"test1","_id":"34053","_score":0.7036234140396118,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.703623}]},"_source":{"url":"/itcast/Corel5k/34000/34053.jpeg"}},{"_index":"test","_type":"test1","_id":"10029","_score":0.7023476958274841,"_extra":{"vector_result":[{"source":"","score":0.702348,"field":"feature1"}]},"_source":{"url":"/itcast/Corel5k/10000/10029.jpeg"}},{"_index":"test","_type":"test1","_id":"21006","_score":0.70234614610672,"_extra":{"vector_result":[{"score":0.702346,"field":"feature1","source":""}]},"_source":{"url":"/itcast/Corel5k/21000/21006.jpeg"}},{"_index":"test","_type":"test1","_id":"10045","_score":0.7022093534469604,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.702209}]},"_source":{"url":"/itcast/Corel5k/10000/10045.jpeg"}},{"_index":"test","_type":"test1","_id":"34074","_score":0.7005892395973206,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.700589}]},"_source":{"url":"/itcast/Corel5k/34000/34074.jpeg"}},{"_index":"test","_type":"test1","_id":"34080","_score":0.6995940208435059,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.699594}]},"_source":{"url":"/itcast/Corel5k/34000/34080.jpeg"}},{"_index":"test","_type":"test1","_id":"34097","_score":0.6968091130256653,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.696809}]},"_source":{"url":"/itcast/Corel5k/34000/34097.jpeg"}},{"_index":"test","_type":"test1","_id":"10031","_score":0.6964012980461121,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.696401}]},"_source":{"url":"/itcast/Corel5k/10000/10031.jpeg"}},{"_index":"test","_type":"test1","_id":"34025","_score":0.6963371634483337,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.696337}]},"_source":{"url":"/itcast/Corel5k/34000/34025.jpeg"}},{"_index":"test","_type":"test1","_id":"10063","_score":0.696236789226532,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.696237}]},"_source":{"url":"/itcast/Corel5k/10000/10063.jpeg"}},{"_index":"test","_type":"test1","_id":"10008","_score":0.6933802366256714,"_extra":{"vector_result":[{"score":0.69338,"field":"feature1","source":""}]},"_source":{"url":"/itcast/Corel5k/10000/10008.jpeg"}},{"_index":"test","_type":"test1","_id":"10032","_score":0.6933799982070923,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.69338}]},"_source":{"url":"/itcast/Corel5k/10000/10032.jpeg"}},{"_index":"test","_type":"test1","_id":"10043","_score":0.6927193999290466,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.692719}]},"_source":{"url":"/itcast/Corel5k/10000/10043.jpeg"}},{"_index":"test","_type":"test1","_id":"10040","_score":0.6926431059837341,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.692643}]},"_source":{"url":"/itcast/Corel5k/10000/10040.jpeg"}},{"_index":"test","_type":"test1","_id":"10041","_score":0.6922421455383301,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.692242}]},"_source":{"url":"/itcast/Corel5k/10000/10041.jpeg"}},{"_index":"test","_type":"test1","_id":"22089","_score":0.6920809149742126,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.692081}]},"_source":{"url":"/itcast/Corel5k/22000/22089.jpeg"}}]}}

#dic = {"took":14,"timed_out":"false","_shards":{"total":2,"failed":0,"successful":2},"hits":{"total":1,"max_score":0.9999997615814209,"hits":[{"_index":"test","_type":"test","_id":"AW8OftTLJG6WicwQyAt2","_score":0.9999997615814209,"_extra":{"vector_result":[{"field":"feature1","source":"","score":0.9999997615814209}]},"_version":1,"_source":{"url":"../images/COCO_val2014_000000123599.jpg"}}]}}
list = dic['hits']['hits']
total = dic['hits']['total']
print(total)
print(list[0]['_source']['url'])
for i in range(total):
  print(list[i]['_source']['url'])
#print(resp.json()) #这里就会返回与传入的图片相似的图片地址及得分

